#!/bin/bash
# Send Signal K notifications by SMS
# Usage: SMS [-t {args ..}]

COMMAND="gammu"
LOGFILE="/tmp/sms.log"
MODE=""

if [ $# -eq 0 ]; then
	echo "Send Signal K notifications by SMS (arguments must be phone numbers)"
	exit 0
fi

if hash ${COMMAND} 2>/dev/null ; then
	MESSAGE=`cat`
	while [ "${1}" != "" ]; do
		case ${1} in
		  -t)	MODE="test";;
		  -l)	MODE="log";;
		   *)
			if [ "${MODE}" == "test" ] || [ "${MODE}" == "log" ]; then
				echo "`date` ${MESSAGE} to ${COMMAND} sendsms TEXT ${1}" >> ${LOGFILE}
			fi
			if [ "${MODE}" != "test" ]; then
				echo "${MESSAGE}" | ${COMMAND} sendsms TEXT ${1}
			fi
			;;
		esac
		shift
	done
	exit 0
else
	>&2 echo "required program '${COMMAND}' is not available"
	exit 1
fi

